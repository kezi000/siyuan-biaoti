[English](README.md)

# AI 标题助理

在思源笔记中一键调用大模型生成标题，兼容所有 OpenAI 风格的接口，并提供手动确认流程。

## 功能亮点

- **完善的 AI 配置界面**：Base URL、API Key、模型、Temperature、Top P、最大 token、语言、风格等全部可调。
- **用户手动触发**：顶栏魔杖按钮与命令面板条目（桌面快捷键 `⇧⌘T`）均可发起，执行状态清晰。
- **自定义提示词**：模板支持 `{{content}}`、`{{language}}`、`{{tone}}` 占位符，方便适配不同文风。
- **上下文策略**：自动（优先选区）、仅选区、整篇文档三种模式，并可设置字符上限，避免泄露多余信息。
- **标题确认弹窗**：生成结果可复制、也可直接调用 `/api/filetree/renameDocByID` 安全替换文档标题。

## 使用步骤

1. 将仓库克隆/复制到 `{工作空间}/data/plugins/plugin-sample`。
2. 安装依赖并开启实时编译：

   ```bash
   pnpm install
   pnpm run dev   # 实时编译
   ```

3. 在思源集市 ▸ 已下载 中启用 **AI 标题助理**。
4. 打开 **设置 ▸ 插件 ▸ AI 标题助理**，配置：
   - API Base URL（默认 `https://api.openai.com/v1`）
   - API Key（仅本地保存，可一键测试连通）
   - 模型与参数（Temperature、Top P、最大 token）
   - 标题语言、风格预设、上下文策略、提示词模板
5. 打开任意文档，点击顶栏魔杖或 `⇧⌘T`，预览生成的标题并选择复制或替换。

### API ??????

1. ???????? **?? ? ?? ? AI ????**?????????AI ??????
2. `API ????` ?????? `API ??` ?????????? `sk-xxx`????????????????
3. ????? **????** ???????? `${baseUrl}/models` ??????????????? ?API ????? ???
4. ?????????? **??**????????????????????????? `{workspace}/data/storage` ????????

![AI ????????](preview.png)

> ?????? ?API ??? ????????????????????/?????`pnpm run dev` ????? Ctrl+R???????????

## 参数说明

- **API Base URL**：任意符合 OpenAI 标准的网关，例如官方 OpenAI、Azure OpenAI、OneAPI 等。
- **API Key**：仅存储在插件数据中；点击 *测试连通* 会调用 `/models` 进行校验。
- **Model**：Chat Completion 模型名称，可自行填写供应商自定义 ID。
- **Temperature / Top P**：控制随机度，默认 0.5 / 1，Top P 不确定时保持 1。
- **Max Tokens**：限制标题长度，避免输出冗长段落。
- **Language & Tone**：写入模板，指示模型使用何种语言/风格。
- **Context Strategy & Limit**：选择自动/选区/全文，字符上限默认 1200，可避免高额 token 消耗。
- **Prompt Template**：支持 `{{content}}`、`{{language}}`、`{{tone}}`，清空即可恢复默认模板。

## 触发流程

1. 用户点击按钮/命令。
2. 插件根据策略抽取上下文，清理空白并截断到设定长度。
3. 构造请求，调用 `${baseUrl}/chat/completions`。
4. 弹窗展示标题，提供 **复制** 与 **替换文档标题**。
5. 替换操作通过官方 API 完成，确保与同步/版本控制兼容。

## 开发与迭代

- `pnpm run dev`：开发模式，`pnpm run build`：打包为 `package.zip`。
- `pnpm run lint`：执行 ESLint。
- 参考 [docs/DEVELOPMENT_PLAN.md](docs/DEVELOPMENT_PLAN.md) 获取完整的最佳实践流程、架构与测试建议。

## 隐私声明

- API Key 永不离开本地，可通过设置面板重新输入或覆盖。
- 仅上传选中的文本或截断后的文档片段，不会扫全库。
- 所有请求都遵循思源的内置 fetch 环境，不包含额外遥测。
