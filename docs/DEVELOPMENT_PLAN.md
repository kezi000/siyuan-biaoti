# AI 标题助理插件 - 最佳实践开发流程

> 目标：让用户在思源笔记中通过大模型快速生成高质量标题，流程需兼顾安全性、可扩展性与良好用户体验。

## 1. 发现与体验对齐
- 与用户确认主要角色（普通用户/写作者/团队）及不同场景下的标题需求。
- 列出核心交互：手动触发、标题预览确认、自定义提示词。
- 明确数据边界：只读取当前文档必要内容，不上传隐私字段。

## 2. 架构与模块划分
- **AIProvider 抽象**：隔离 OpenAI 兼容接口，方便后续扩展到其他供应商或自建模型。
- **Configuration Store**：集中管理 API Key、Base URL、模型、采样参数和提示词模板，提供读写校验。
- **Context Extractor**：可切换“全文/首段/选区”策略，限制字符数并做清洗，以减轻 token 成本。
- **UI Layer**：统一由插件 Setting 面板、顶栏按钮、命令面板复用，保持响应式布局。

## 3. 安全与配置管理
- API Key 仅保存在用户本地配置；界面展示“已设置”状态，避免明文回显。
- 允许 Base URL、自定义 header，保证与各类 OpenAI 兼容网关适配。
- 提供“测试连接”按钮，请求 `/models` 或一次性最小消息，捕获报错并提示。

## 4. 提示词与参数最佳实践
- 默认提示词包含 `{{content}}`、`{{language}}` 等占位符，生成前进行模板渲染。
- 暴露温度、Top P、最大 token、风格 preset，帮助用户调控输出稳定性。
- 统一在调用前做 prompt lint（去空格、限制长度、追加安全提醒），避免越权输出。

## 5. 交互流程
1. 用户点击顶栏按钮或快捷键。
2. 插件读取当前文档内容（可配置范围）并展示“正在生成”状态。
3. 调用 AIProvider，解析响应；失败时提示错误与重试按钮。
4. 弹出标题预览对话框，提供“替换文档标题 / 复制 / 关闭”三个操作。
5. 写入成功后 toast 提示，并在日志中记录模型、耗时等调试信息。

## 6. 质量保证
- 使用 mock fetch 单元测试 prompt 渲染与响应解析。
- 人工回归：无配置、网络失败、移动端尺寸、不同语言提示词。
- 记录日志（可选 debug 模式）帮助定位 API 调用耗时和错误码。

## 7. 发布与反馈闭环
- `pnpm run build` 后检查 package.zip 包含配置、图标与 README。
- 在 README 中列出隐私承诺、使用步骤、常见问题。
- 上架后监控 issues，可通过内置“反馈”链接快速跳转仓库收集意见。

该流程既覆盖了产品需求验证，也定义了插件落地的技术骨架，接下来按此步骤实现即可平滑推进迭代。
